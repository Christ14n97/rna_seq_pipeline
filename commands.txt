
# merge fasta files
cat Dictyostelium_discoideum_Ax4/dicty_primary_genomic.fasta Mycobacterium_marinum/GCF_000018345.1_ASM1834v1_genomic.fna > dicty_myco_merged_genomes.fna

# substitution of CDS to exon in Mycobacterium gff and generation of merged gff file 

sed -E 's/(\tCDS\t)/\texon\t/' test/reference_genomes/Mycobacterium_marinum/GCF_000018345.1_ASM1834v1_genomic.gff \
    > test/reference_genomes/Mycobacterium_marinum/V2_GCF_000018345.1_ASM1834v1_genomic.gff
    
cat test/reference_genomes/Dictyostelium_discoideum_Ax4/gff3/*.gff test/reference_genomes/Mycobacterium_marinum/V2_GCF_000018345.1_ASM1834v1_genomic.gff > test/reference_genomes/dicty_myco_merged_annotation.gff

# WORKDIR
cd test/reference_genomes
 
# index generation command for merged genomes
STAR --runMode genomeGenerate --genomeSAindexNbases 10 --genomeDir dicty_myco_merged_star_index/ \
    --genomeFastaFiles dicty_myco_merged_genomes.fna \
    --sjdbGTFtagExonParentTranscript Parent --sjdb \
    --sjdbGTFfile dicty_myco_merged_annotation.gff --runThreadN 10

### I had to create the fasta.fai with samtools
samtools faidx dicty_myco_merged_genomes.fna

# mapping command
STAR --runMode alignReads --genomeDir dicty_myco_merged_star_index/ --outSAMtype BAM SortedByCoordinate \
    --readFilesIn ../fastq/DAEZ01_S1_L003_R1_001.fastq.gz --runThreadN 10 \
    --outReadsUnmapped Fastx --readFilesCommand gunzip -c --quantMode GeneCounts \
    --outFileNamePrefix ../mapped/

samtools view -h mapped/Aligned.sortedByCoord.out.bam | head
samtools idxstat file.bam



###### Makefie commands ######
make DAEZ01_S1_L003_R1_001.bam.idxstat BAM_FILE=../mapped/DAEZ01_S1_L003_R1_001.DdMm.star/Aligned.sortedByCoord.out.bam

STEP 1: change directory to folder containing fastq-gz files

cd path/to/fastq.gz_files

STEP 2: Create array
files=($(basename --suffix=.fastq.gz -- *.fastq.gz))

STEP 3: Loop over the array and do make

for n in ${files[@]}; do make BASE_NAME=$n \
	GENOME_DIR=../reference_genomes/dicty_myco_merged_star_index \
	QUANT_MODE='gene' \
	BAM_FILE=../mapped/${n}.DdMm.star/Aligned.sortedByCoord.out.bam ; done
